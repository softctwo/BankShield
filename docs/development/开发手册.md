# BankShield 开发手册

**文档版本**: v1.0  
**项目名称**: BankShield - 银行数据安全管理系统  
**编写日期**: 2026-01-07  

---

## 1. 开发环境搭建

### 1.1 环境要求

**后端开发环境**:
- JDK 17+
- Maven 3.8+
- MySQL 8.0+
- Redis 6.0+
- IntelliJ IDEA 2023+ (推荐)

**前端开发环境**:
- Node.js 18+
- npm 9+ 或 pnpm 8+
- VS Code (推荐)

**可选工具**:
- Docker Desktop
- Postman (API测试)
- Redis Desktop Manager
- MySQL Workbench

### 1.2 克隆项目

```bash
git clone https://github.com/your-org/BankShield.git
cd BankShield
```

### 1.3 后端环境配置

#### 1.3.1 数据库初始化

```bash
# 登录MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE bankshield CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 导入初始化脚本
USE bankshield;
SOURCE sql/init_database.sql;
SOURCE sql/init_data.sql;
```

#### 1.3.2 Redis配置

```bash
# 启动Redis
redis-server

# 验证连接
redis-cli ping
# 应返回: PONG
```

#### 1.3.3 配置文件

编辑 `bankshield-api/src/main/resources/application-dev.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/bankshield?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: your_password
    
  redis:
    host: localhost
    port: 6379
    password: # 如果有密码则填写
```

#### 1.3.4 构建后端

```bash
# 完整构建
mvn clean install -DskipTests

# 仅构建API模块
cd bankshield-api
mvn clean package -DskipTests
```

### 1.4 前端环境配置

#### 1.4.1 安装依赖

```bash
cd bankshield-ui
npm install
# 或使用pnpm
pnpm install
```

#### 1.4.2 配置环境变量

编辑 `.env.development`:

```env
VITE_APP_BASE_API=http://localhost:8081
VITE_APP_TITLE=BankShield开发环境
```

#### 1.4.3 启动前端

```bash
npm run dev
# 访问 http://localhost:3000
```

---

## 2. 项目结构说明

### 2.1 后端项目结构

```
bankshield-api/
├── src/main/java/com/bankshield/api/
│   ├── annotation/          # 自定义注解
│   │   ├── RoleExclusive.java
│   │   └── MaskData.java
│   ├── aspect/              # AOP切面
│   │   ├── AuditLogAspect.java
│   │   └── DataMaskAspect.java
│   ├── config/              # 配置类
│   │   ├── SecurityConfig.java
│   │   ├── RedisConfig.java
│   │   └── VaultConfig.java
│   ├── controller/          # 控制器
│   │   ├── UserController.java
│   │   ├── RoleController.java
│   │   └── ...
│   ├── service/             # 服务接口
│   │   ├── UserService.java
│   │   └── impl/            # 服务实现
│   │       └── UserServiceImpl.java
│   ├── mapper/              # MyBatis Mapper
│   │   └── UserMapper.java
│   ├── entity/              # 实体类
│   │   └── User.java
│   ├── dto/                 # 数据传输对象
│   │   └── UserDTO.java
│   ├── enums/               # 枚举类
│   │   └── UserStatus.java
│   └── BankShieldApiApplication.java
└── src/main/resources/
    ├── application.yml
    ├── application-dev.yml
    ├── application-prod.yml
    └── mapper/              # MyBatis XML
        └── UserMapper.xml
```

### 2.2 前端项目结构

```
bankshield-ui/
├── src/
│   ├── api/                 # API接口
│   │   ├── user.ts
│   │   └── auth.ts
│   ├── assets/              # 静态资源
│   ├── components/          # 通用组件
│   │   ├── Layout/
│   │   └── Common/
│   ├── router/              # 路由配置
│   │   ├── index.ts
│   │   └── modules/
│   ├── store/               # Pinia状态管理
│   │   ├── user.ts
│   │   └── app.ts
│   ├── types/               # TypeScript类型
│   │   └── user.d.ts
│   ├── utils/               # 工具函数
│   │   ├── request.ts
│   │   └── auth.ts
│   ├── views/               # 页面组件
│   │   ├── login/
│   │   ├── dashboard/
│   │   └── user/
│   ├── App.vue
│   └── main.ts
├── public/
├── package.json
└── vite.config.ts
```

---

## 3. 开发规范

### 3.1 Java开发规范

#### 3.1.1 命名规范

**类命名**:
- Controller: `UserController`
- Service接口: `UserService`
- Service实现: `UserServiceImpl`
- Mapper: `UserMapper`
- Entity: `User`
- DTO: `UserDTO`

**方法命名**:
- 查询单个: `getById`, `getByUsername`
- 查询列表: `list`, `listByStatus`
- 分页查询: `page`
- 新增: `save`, `create`
- 更新: `update`, `modify`
- 删除: `delete`, `remove`

**变量命名**:
- 使用驼峰命名: `userName`, `createTime`
- 布尔类型: `isEnabled`, `hasPermission`
- 集合类型: `userList`, `roleSet`

#### 3.1.2 注解使用

```java
@RestController
@RequestMapping("/api/users")
@Api(tags = "用户管理")
@Slf4j
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    @ApiOperation("获取用户详情")
    @PreAuthorize("hasRole('ADMIN')")
    public Result<User> getUser(@PathVariable Long id) {
        User user = userService.getById(id);
        return Result.success(user);
    }
}
```

#### 3.1.3 异常处理

```java
// 自定义异常
public class BusinessException extends RuntimeException {
    private Integer code;
    
    public BusinessException(String message) {
        super(message);
        this.code = 500;
    }
}

// 全局异常处理
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        log.error("业务异常: {}", e.getMessage());
        return Result.error(e.getMessage());
    }
}
```

#### 3.1.4 日志规范

```java
@Slf4j
public class UserServiceImpl implements UserService {
    
    @Override
    public User getById(Long id) {
        log.info("查询用户: id={}", id);
        
        try {
            User user = userMapper.selectById(id);
            log.debug("查询结果: {}", user);
            return user;
        } catch (Exception e) {
            log.error("查询用户失败: id={}", id, e);
            throw new BusinessException("查询用户失败");
        }
    }
}
```

### 3.2 Vue开发规范

#### 3.2.1 组件命名

```typescript
// 文件名: UserList.vue
// 组件名: UserList
<script setup lang="ts">
defineOptions({
  name: 'UserList'
})
</script>
```

#### 3.2.2 TypeScript类型定义

```typescript
// types/user.d.ts
export interface User {
  id: number
  username: string
  email: string
  status: number
  createTime: string
}

export interface UserQuery {
  username?: string
  status?: number
  current: number
  size: number
}
```

#### 3.2.3 API封装

```typescript
// api/user.ts
import request from '@/utils/request'
import type { User, UserQuery } from '@/types/user'

export function getUserList(params: UserQuery) {
  return request.get<PageResult<User>>('/api/users', { params })
}

export function getUserDetail(id: number) {
  return request.get<User>(`/api/users/${id}`)
}

export function createUser(data: Partial<User>) {
  return request.post('/api/users', data)
}
```

#### 3.2.4 组件开发

```vue
<template>
  <div class="user-list">
    <el-table v-loading="loading" :data="userList">
      <el-table-column prop="username" label="用户名" />
      <el-table-column prop="email" label="邮箱" />
    </el-table>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { getUserList } from '@/api/user'
import type { User } from '@/types/user'

const loading = ref(false)
const userList = ref<User[]>([])

const loadData = async () => {
  loading.value = true
  try {
    const res = await getUserList({ current: 1, size: 10 })
    userList.value = res.data.records
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  loadData()
})
</script>

<style scoped lang="less">
.user-list {
  padding: 20px;
}
</style>
```

---

## 4. 常用开发命令

### 4.1 后端命令

```bash
# 编译项目
mvn clean compile

# 运行测试
mvn test

# 打包（跳过测试）
mvn clean package -DskipTests

# 运行Spring Boot应用
mvn spring-boot:run

# 代码格式化
mvn spotless:apply

# 依赖树
mvn dependency:tree
```

### 4.2 前端命令

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 生产构建
npm run build

# 类型检查
npm run type-check

# 代码格式化
npm run format

# Lint检查
npm run lint

# 单元测试
npm run test
```

---

## 5. 调试技巧

### 5.1 后端调试

#### 5.1.1 IDEA调试配置

1. 点击 Run -> Edit Configurations
2. 添加 Spring Boot 配置
3. 设置断点并启动调试

#### 5.1.2 日志级别调整

```yaml
logging:
  level:
    com.bankshield: DEBUG
    org.springframework.web: DEBUG
```

### 5.2 前端调试

#### 5.2.1 浏览器DevTools

- F12 打开开发者工具
- Console查看日志
- Network查看网络请求
- Vue DevTools查看组件状态

#### 5.2.2 VS Code调试

创建 `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "chrome",
      "request": "launch",
      "name": "Launch Chrome",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}/bankshield-ui/src"
    }
  ]
}
```

---

## 6. 测试指南

### 6.1 单元测试

#### 6.1.1 后端单元测试

```java
@SpringBootTest
class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    void testGetById() {
        User user = userService.getById(1L);
        assertNotNull(user);
        assertEquals("admin", user.getUsername());
    }
}
```

#### 6.1.2 前端单元测试

```typescript
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import UserList from '@/views/user/UserList.vue'

describe('UserList', () => {
  it('renders properly', () => {
    const wrapper = mount(UserList)
    expect(wrapper.text()).toContain('用户列表')
  })
})
```

### 6.2 集成测试

```java
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    void testGetUser() throws Exception {
        mockMvc.perform(get("/api/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200));
    }
}
```

---

## 7. 常见问题

### 7.1 后端常见问题

**Q: 启动时提示端口被占用**
```bash
# 查找占用端口的进程
lsof -i :8081
# 杀死进程
kill -9 <PID>
```

**Q: 数据库连接失败**
- 检查MySQL是否启动
- 检查用户名密码是否正确
- 检查数据库是否存在

**Q: Redis连接失败**
- 检查Redis是否启动
- 检查配置文件中的host和port

### 7.2 前端常见问题

**Q: npm install 失败**
```bash
# 清除缓存
npm cache clean --force
# 删除node_modules和package-lock.json
rm -rf node_modules package-lock.json
# 重新安装
npm install
```

**Q: 跨域问题**
- 检查vite.config.ts中的proxy配置
- 确保后端允许跨域

**Q: 页面空白**
- 检查浏览器控制台错误
- 检查路由配置
- 检查API请求是否成功

---

## 8. Git工作流

### 8.1 分支管理

- `main`: 主分支，生产环境代码
- `develop`: 开发分支
- `feature/*`: 功能分支
- `bugfix/*`: 修复分支
- `hotfix/*`: 紧急修复分支

### 8.2 提交规范

```bash
# 格式: <type>(<scope>): <subject>

# 示例
git commit -m "feat(user): 添加用户管理功能"
git commit -m "fix(auth): 修复登录token过期问题"
git commit -m "docs(readme): 更新README文档"
```

**类型说明**:
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建/工具相关

### 8.3 代码审查

1. 创建Pull Request
2. 至少一人审查
3. 通过CI/CD检查
4. 合并到目标分支

---

## 9. 性能优化

### 9.1 后端优化

- 使用Redis缓存热点数据
- 数据库查询优化（索引、分页）
- 异步处理耗时操作
- 连接池配置优化

### 9.2 前端优化

- 路由懒加载
- 组件按需引入
- 图片压缩和懒加载
- 使用CDN加速

---

## 10. 安全开发

### 10.1 输入验证

```java
@PostMapping
public Result createUser(@Valid @RequestBody UserDTO userDTO) {
    // @Valid自动验证
}
```

### 10.2 SQL注入防护

```java
// 使用MyBatis参数绑定
@Select("SELECT * FROM sys_user WHERE username = #{username}")
User selectByUsername(@Param("username") String username);
```

### 10.3 XSS防护

```typescript
// 前端转义
import { escapeHtml } from '@/utils/security'
const safeContent = escapeHtml(userInput)
```

---

**文档结束**

**编写人**: BankShield Development Team  
**审核人**: ________________  日期: ________
