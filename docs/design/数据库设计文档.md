# BankShield 数据库设计文档

**文档版本**: v1.0  
**项目名称**: BankShield - 银行数据安全管理系统  
**编写日期**: 2026-01-07  
**数据库**: MySQL 8.0+  

---

## 1. 数据库概述

### 1.1 数据库信息

- **数据库名称**: bankshield
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **存储引擎**: InnoDB
- **数据库版本**: MySQL 8.0+

### 1.2 设计原则

- 遵循第三范式（3NF）
- 使用BIGINT作为主键
- 统一时间字段命名（create_time, update_time）
- 关键字段添加索引
- 敏感数据加密存储
- 软删除机制（deleted字段）

---

## 2. 数据库ER图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│  sys_user   │───────│rel_user_role│───────│  sys_role   │
│  用户表     │  N:M  │ 用户角色关联│  N:M  │  角色表     │
└─────────────┘       └─────────────┘       └─────────────┘
       │                                            │
       │                                            │
       │ 1:N                                    1:N │
       │                                            │
       ▼                                            ▼
┌─────────────┐                            ┌─────────────┐
│ audit_log   │                            │rel_role_menu│
│ 审计日志表  │                            │角色菜单关联 │
└─────────────┘                            └─────────────┘
                                                   │
                                               1:N │
                                                   ▼
                                           ┌─────────────┐
                                           │  sys_menu   │
                                           │  菜单表     │
                                           └─────────────┘
```

---

## 3. 核心表设计

### 3.1 系统管理模块

#### 3.1.1 用户表 (sys_user)

**表名**: sys_user  
**说明**: 存储系统用户信息

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 用户ID（主键） |
| username | VARCHAR | 50 | NO | - | 用户名（唯一） |
| password | VARCHAR | 255 | NO | - | 密码（加密存储） |
| real_name | VARCHAR | 50 | YES | NULL | 真实姓名 |
| email | VARCHAR | 100 | NO | - | 邮箱（唯一） |
| phone | VARCHAR | 20 | YES | NULL | 手机号 |
| dept_id | BIGINT | - | YES | NULL | 部门ID |
| status | TINYINT | - | NO | 1 | 状态（0-禁用,1-启用） |
| last_login_time | DATETIME | - | YES | NULL | 最后登录时间 |
| last_login_ip | VARCHAR | 50 | YES | NULL | 最后登录IP |
| create_by | VARCHAR | 50 | YES | NULL | 创建人 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_by | VARCHAR | 50 | YES | NULL | 更新人 |
| update_time | DATETIME | - | YES | ON UPDATE | 更新时间 |
| remark | VARCHAR | 500 | YES | NULL | 备注 |

**索引**:
- PRIMARY KEY (id)
- UNIQUE KEY uk_username (username)
- UNIQUE KEY uk_email (email)
- KEY idx_dept_id (dept_id)
- KEY idx_status (status)

**SQL语句**:
```sql
CREATE TABLE `sys_user` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
    `username` VARCHAR(50) NOT NULL COMMENT '用户名',
    `password` VARCHAR(255) NOT NULL COMMENT '密码',
    `real_name` VARCHAR(50) DEFAULT NULL COMMENT '真实姓名',
    `email` VARCHAR(100) NOT NULL COMMENT '邮箱',
    `phone` VARCHAR(20) DEFAULT NULL COMMENT '手机号',
    `dept_id` BIGINT DEFAULT NULL COMMENT '部门ID',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
    `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
    `last_login_ip` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
    `create_by` VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_by` VARCHAR(50) DEFAULT NULL COMMENT '更新人',
    `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_email` (`email`),
    KEY `idx_dept_id` (`dept_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 3.1.2 角色表 (sys_role)

**表名**: sys_role  
**说明**: 存储系统角色信息

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 角色ID |
| role_name | VARCHAR | 50 | NO | - | 角色名称 |
| role_code | VARCHAR | 50 | NO | - | 角色编码 |
| description | VARCHAR | 200 | YES | NULL | 描述 |
| data_scope | TINYINT | - | NO | 1 | 数据范围 |
| status | TINYINT | - | NO | 1 | 状态 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | YES | ON UPDATE | 更新时间 |

**SQL语句**:
```sql
CREATE TABLE `sys_role` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '角色ID',
    `role_name` VARCHAR(50) NOT NULL COMMENT '角色名称',
    `role_code` VARCHAR(50) NOT NULL COMMENT '角色编码',
    `description` VARCHAR(200) DEFAULT NULL COMMENT '描述',
    `data_scope` TINYINT NOT NULL DEFAULT 1 COMMENT '数据范围:1-全部,2-部门,3-本人',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_role_code` (`role_code`),
    KEY `idx_role_name` (`role_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

#### 3.1.3 菜单表 (sys_menu)

**表名**: sys_menu  
**说明**: 存储系统菜单信息

```sql
CREATE TABLE `sys_menu` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '菜单ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父菜单ID',
    `menu_name` VARCHAR(50) NOT NULL COMMENT '菜单名称',
    `menu_code` VARCHAR(50) NOT NULL COMMENT '菜单编码',
    `menu_type` TINYINT NOT NULL COMMENT '菜单类型:1-目录,2-菜单,3-按钮',
    `path` VARCHAR(200) DEFAULT NULL COMMENT '路由地址',
    `component` VARCHAR(200) DEFAULT NULL COMMENT '组件路径',
    `icon` VARCHAR(50) DEFAULT NULL COMMENT '图标',
    `sort_order` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `visible` TINYINT NOT NULL DEFAULT 1 COMMENT '是否可见',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜单表';
```

### 3.2 审计日志模块

#### 3.2.1 审计日志表 (audit_log)

**表名**: audit_log  
**说明**: 存储系统操作审计日志

```sql
CREATE TABLE `audit_log` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    `user_id` BIGINT DEFAULT NULL COMMENT '用户ID',
    `username` VARCHAR(50) DEFAULT NULL COMMENT '用户名',
    `operation` VARCHAR(50) NOT NULL COMMENT '操作类型',
    `module` VARCHAR(50) NOT NULL COMMENT '模块名称',
    `method` VARCHAR(10) NOT NULL COMMENT '请求方法',
    `request_url` VARCHAR(500) DEFAULT NULL COMMENT '请求URL',
    `request_params` TEXT COMMENT '请求参数',
    `ip_address` VARCHAR(50) DEFAULT NULL COMMENT 'IP地址',
    `location` VARCHAR(100) DEFAULT NULL COMMENT '操作地点',
    `result` TINYINT NOT NULL COMMENT '操作结果:0-失败,1-成功',
    `error_msg` TEXT COMMENT '错误信息',
    `execution_time` INT DEFAULT NULL COMMENT '执行时间(ms)',
    `blockchain_hash` VARCHAR(128) DEFAULT NULL COMMENT '区块链哈希',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_operation` (`operation`),
    KEY `idx_create_time` (`create_time`),
    KEY `idx_blockchain_hash` (`blockchain_hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审计日志表';
```

### 3.3 加密管理模块

#### 3.3.1 加密密钥表 (encrypt_key)

**表名**: encrypt_key  
**说明**: 存储加密密钥元数据

```sql
CREATE TABLE `encrypt_key` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '密钥ID',
    `key_name` VARCHAR(100) NOT NULL COMMENT '密钥名称',
    `key_type` VARCHAR(20) NOT NULL COMMENT '密钥类型:SM2,SM4,AES,RSA',
    `key_usage` VARCHAR(50) DEFAULT NULL COMMENT '密钥用途',
    `key_status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:0-禁用,1-启用,2-已轮换',
    `vault_path` VARCHAR(200) DEFAULT NULL COMMENT 'Vault存储路径',
    `rotation_period` INT DEFAULT NULL COMMENT '轮换周期(天)',
    `last_rotation_time` DATETIME DEFAULT NULL COMMENT '上次轮换时间',
    `next_rotation_time` DATETIME DEFAULT NULL COMMENT '下次轮换时间',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `expire_time` DATETIME DEFAULT NULL COMMENT '过期时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_key_name` (`key_name`),
    KEY `idx_key_type` (`key_type`),
    KEY `idx_next_rotation` (`next_rotation_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='加密密钥表';
```

### 3.4 数据脱敏模块

#### 3.4.1 脱敏规则表 (desensitization_rule)

**表名**: desensitization_rule  
**说明**: 存储数据脱敏规则

```sql
CREATE TABLE `desensitization_rule` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '规则ID',
    `rule_name` VARCHAR(100) NOT NULL COMMENT '规则名称',
    `rule_type` VARCHAR(20) NOT NULL COMMENT '规则类型:MASK,REPLACE,ENCRYPT,HASH',
    `data_type` VARCHAR(50) DEFAULT NULL COMMENT '数据类型',
    `pattern` VARCHAR(200) DEFAULT NULL COMMENT '匹配模式',
    `mask_char` VARCHAR(10) DEFAULT '*' COMMENT '脱敏字符',
    `keep_prefix` INT DEFAULT 0 COMMENT '保留前缀长度',
    `keep_suffix` INT DEFAULT 0 COMMENT '保留后缀长度',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
    `priority` INT DEFAULT 0 COMMENT '优先级',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_rule_name` (`rule_name`),
    KEY `idx_data_type` (`data_type`),
    KEY `idx_priority` (`priority`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='脱敏规则表';
```

### 3.5 安全扫描模块

#### 3.5.1 扫描任务表 (security_scan_task)

**表名**: security_scan_task  
**说明**: 存储安全扫描任务

```sql
CREATE TABLE `security_scan_task` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '任务ID',
    `task_name` VARCHAR(100) NOT NULL COMMENT '任务名称',
    `scan_type` VARCHAR(50) NOT NULL COMMENT '扫描类型',
    `target_type` VARCHAR(50) DEFAULT NULL COMMENT '目标类型',
    `target_path` VARCHAR(500) DEFAULT NULL COMMENT '目标路径',
    `status` VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT '状态',
    `progress` INT DEFAULT 0 COMMENT '进度',
    `start_time` DATETIME DEFAULT NULL COMMENT '开始时间',
    `end_time` DATETIME DEFAULT NULL COMMENT '结束时间',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='安全扫描任务表';
```

#### 3.5.2 漏洞记录表 (vulnerability_record)

**表名**: vulnerability_record  
**说明**: 存储发现的安全漏洞

```sql
CREATE TABLE `vulnerability_record` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '漏洞ID',
    `task_id` BIGINT NOT NULL COMMENT '所属扫描任务ID',
    `vuln_code` VARCHAR(100) NOT NULL COMMENT '漏洞编码',
    `vuln_name` VARCHAR(200) NOT NULL COMMENT '漏洞名称',
    `vuln_type` VARCHAR(50) NOT NULL COMMENT '漏洞类型',
    `severity` VARCHAR(20) NOT NULL COMMENT '严重程度',
    `cvss_score` DECIMAL(3,1) DEFAULT NULL COMMENT 'CVSS评分',
    `cve_id` VARCHAR(50) DEFAULT NULL COMMENT 'CVE编号',
    `cwe_id` VARCHAR(50) DEFAULT NULL COMMENT 'CWE编号',
    `description` TEXT COMMENT '描述',
    `location` VARCHAR(500) DEFAULT NULL COMMENT '位置',
    `affected_component` VARCHAR(200) DEFAULT NULL COMMENT '受影响组件',
    `affected_version` VARCHAR(100) DEFAULT NULL COMMENT '受影响版本',
    `proof_of_concept` TEXT COMMENT '漏洞证明',
    `impact` TEXT COMMENT '影响',
    `recommendation` TEXT COMMENT '修复建议',
    `reference_links` TEXT COMMENT '参考链接',
    `status` VARCHAR(20) NOT NULL DEFAULT 'OPEN' COMMENT '状态',
    `assigned_to` VARCHAR(100) DEFAULT NULL COMMENT '处理人',
    `resolved_by` VARCHAR(100) DEFAULT NULL COMMENT '解决人',
    `resolved_time` DATETIME DEFAULT NULL COMMENT '解决时间',
    `resolution_notes` TEXT COMMENT '解决说明',
    `verification_status` VARCHAR(20) DEFAULT NULL COMMENT '验证状态',
    `verified_by` VARCHAR(100) DEFAULT NULL COMMENT '验证人',
    `verified_time` DATETIME DEFAULT NULL COMMENT '验证时间',
    `created_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_task_id` (`task_id`),
    KEY `idx_severity` (`severity`),
    KEY `idx_status` (`status`),
    KEY `idx_created_time` (`created_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='漏洞记录表';
```

### 3.6 数据血缘模块

#### 3.6.1 血缘节点表 (data_lineage_node)

```sql
CREATE TABLE `data_lineage_node` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '节点ID',
    `node_name` VARCHAR(200) NOT NULL COMMENT '节点名称',
    `node_type` VARCHAR(50) NOT NULL COMMENT '节点类型',
    `database_name` VARCHAR(100) DEFAULT NULL COMMENT '数据库名',
    `schema_name` VARCHAR(100) DEFAULT NULL COMMENT '模式名',
    `table_name` VARCHAR(100) DEFAULT NULL COMMENT '表名',
    `column_name` VARCHAR(100) DEFAULT NULL COMMENT '列名',
    `description` TEXT COMMENT '描述',
    `metadata` JSON COMMENT '元数据',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_node_type` (`node_type`),
    KEY `idx_table_name` (`table_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据血缘节点表';
```

#### 3.6.2 血缘关系表 (data_lineage_edge)

```sql
CREATE TABLE `data_lineage_edge` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关系ID',
    `source_node_id` BIGINT NOT NULL COMMENT '源节点ID',
    `target_node_id` BIGINT NOT NULL COMMENT '目标节点ID',
    `edge_type` VARCHAR(50) NOT NULL COMMENT '关系类型',
    `transformation` TEXT COMMENT '转换逻辑',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_source_node` (`source_node_id`),
    KEY `idx_target_node` (`target_node_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据血缘关系表';
```

---

## 4. 索引设计

### 4.1 索引类型

- **主键索引**: 每张表的id字段
- **唯一索引**: username, email, key_name等唯一字段
- **普通索引**: 查询频繁的字段
- **组合索引**: 多字段联合查询

### 4.2 索引优化原则

- 选择性高的列优先建索引
- 避免在低选择性列建索引
- 组合索引遵循最左前缀原则
- 定期分析索引使用情况
- 删除冗余和未使用的索引

---

## 5. 数据字典

### 5.1 状态码字典

| 状态类型 | 值 | 说明 |
|---------|---|------|
| 用户状态 | 0 | 禁用 |
| 用户状态 | 1 | 启用 |
| 操作结果 | 0 | 失败 |
| 操作结果 | 1 | 成功 |
| 密钥状态 | 0 | 禁用 |
| 密钥状态 | 1 | 启用 |
| 密钥状态 | 2 | 已轮换 |

### 5.2 枚举值字典

**漏洞严重程度**:
- CRITICAL - 严重
- HIGH - 高危
- MEDIUM - 中危
- LOW - 低危
- INFO - 信息

**漏洞状态**:
- OPEN - 未解决
- IN_PROGRESS - 处理中
- RESOLVED - 已解决
- WONT_FIX - 不修复
- FALSE_POSITIVE - 误报

---

## 6. 数据库维护

### 6.1 备份策略

- **全量备份**: 每天凌晨2点
- **增量备份**: 每4小时一次
- **备份保留**: 30天
- **异地备份**: 每周同步到异地

### 6.2 性能优化

- 定期执行 ANALYZE TABLE
- 定期执行 OPTIMIZE TABLE
- 监控慢查询日志
- 定期清理历史数据

### 6.3 安全措施

- 敏感数据加密存储
- 定期更新数据库密码
- 限制数据库访问权限
- 启用审计日志

---

**文档结束**

**批准签字**:

数据库设计师: ________________  日期: ________

技术负责人: ______________  日期: ________
