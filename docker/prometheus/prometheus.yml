global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Alertmanager配置
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# 加载告警规则
rule_files:
  - "alert_rules/*.yml"

# 监控目标配置
scrape_configs:
  # Prometheus自身监控
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # BankShield核心服务监控
  - job_name: 'bankshield-gateway'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['gateway:80']
    scrape_interval: 15s
    scrape_timeout: 10s

  - job_name: 'bankshield-auth'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['auth:8081']
    scrape_interval: 15s
    scrape_timeout: 10s

  - job_name: 'bankshield-api'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['api:8080']
    scrape_interval: 15s
    scrape_timeout: 10s

  - job_name: 'bankshield-monitor'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['monitor:8888']
    scrape_interval: 15s
    scrape_timeout: 10s

  # Spring Boot Admin监控
  - job_name: 'spring-boot-admin'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['monitor:8888']
    scrape_interval: 15s

  # MySQL数据库监控
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql:3306']
    scrape_interval: 30s

  # Redis缓存监控
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']
    scrape_interval: 30s

  # 系统级监控 (Node Exporter)
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 15s

  # JVM监控
  - job_name: 'jvm'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: 
          - 'gateway:80'
          - 'auth:8081'
          - 'api:8080'
          - 'monitor:8888'
    scrape_interval: 15s

  # 自定义业务指标监控
  - job_name: 'bankshield-business-metrics'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['monitor:8888']
    scrape_interval: 10s
    params:
      match[]:
        - 'bankshield_*'

  # 安全相关指标监控
  - job_name: 'bankshield-security-metrics'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['monitor:8888']
    scrape_interval: 10s
    params:
      match[]:
        - 'bankshield_security_*'

  # 性能指标监控
  - job_name: 'bankshield-performance-metrics'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['monitor:8888']
    scrape_interval: 10s
    params:
      match[]:
        - 'bankshield_*_response_time'
        - 'bankshield_system_*'