<!--
同步影响报告
==============
版本变更: 无 → 1.0.0
修改的原则: 无（初始版本）
添加的部分:
  - 核心原则（6项）：安全优先、测试先行、合规驱动、清晰审计、模块化架构、简洁性原则
  - 技术约束：技术栈要求、加密标准、代码质量标准
  - 开发流程：代码审查、质量门禁、部署流程
  - 治理规则：修订流程、版本控制、合规审查
删除的部分: 无
模板更新状态:
  - .specify/templates/plan-template.md ✅ 已验证兼容
  - .specify/templates/spec-template.md ✅ 已验证兼容
  - .specify/templates/tasks-template.md ✅ 已验证兼容
后续待办: 无
-->

# BankShield 系统宪法

## 核心原则

### 一、安全优先

本系统处理银行敏感数据，安全性是最高优先级。

- 所有外部输入必须经过严格验证和消毒处理
- 敏感数据必须使用国密算法（SM2/SM3/SM4）或国际标准加密算法（AES/RSA）进行加密存储
- 禁止在日志、响应或错误信息中暴露敏感数据
- 所有 API 端点必须实施认证和授权检查
- 遵循最小权限原则，用户只能访问其职责范围内的数据
- 所有安全相关变更必须经过安全审查

**理由**：金融行业对数据安全有严格的监管要求，任何安全漏洞都可能导致严重的法律和声誉风险。

### 二、测试先行（不可妥协）

测试驱动开发是强制性要求，确保系统的可靠性和可维护性。

- TDD 强制执行：先编写测试 → 测试失败 → 实现功能 → 测试通过 → 重构
- 核心业务逻辑必须有单元测试覆盖
- API 端点必须有契约测试
- 关键用户流程必须有集成测试
- 禁止禁用测试或使用 `@Ignore` 注解跳过测试，必须修复失败的测试
- 提交前所有测试必须通过

**理由**：银行系统的错误可能导致资金损失或合规问题，测试是保障系统正确性的基础。

### 三、合规驱动

系统开发必须符合金融行业监管要求。

- 遵循《个人金融信息保护技术规范》（JR/T 0171-2020）
- 遵循《银行业金融机构数据治理指引》
- 实施数据分类分级管理（C1-C4 级别）
- 敏感数据处理必须有明确的脱敏策略
- 数据保留和销毁必须符合监管期限要求
- 跨境数据传输必须符合数据出境规定

**理由**：金融行业受严格监管，合规违规可能导致行政处罚、业务暂停甚至吊销牌照。

### 四、清晰审计

所有数据操作必须可追溯，支持审计和问责。

- 关键操作必须记录审计日志：操作人、操作时间、操作类型、操作对象、操作结果
- 审计日志必须防篡改（使用区块链或哈希链技术）
- 日志保留期限必须符合监管要求（至少5年）
- 敏感数据访问必须单独记录
- 审计日志必须支持快速检索和导出
- 使用结构化日志格式（JSON）便于分析

**理由**：监管机构要求金融机构能够追溯所有数据操作，审计能力是合规的基本要求。

### 五、模块化架构

采用模块化设计，确保系统的可扩展性和可维护性。

- 每个服务模块必须职责单一，边界清晰
- 模块间通过定义良好的 API 或消息进行通信
- 公共功能抽取到 common 模块，避免重复代码
- 前后端分离，API 优先设计
- 配置外部化，支持多环境部署
- 依赖注入，便于测试和替换

**理由**：银行系统需要长期维护和持续演进，模块化架构降低变更成本和风险。

### 六、简洁性原则

避免过度工程化，保持代码简洁可读。

- 从最简单的可行方案开始
- 不为假设的未来需求预设设计
- 每次变更只解决当前问题，不添加额外功能
- 如果代码需要注释解释，说明它太复杂了
- 删除无用代码，不保留"以防万一"的代码
- 优先使用项目中已有的工具和模式

**理由**：简洁的代码更容易理解、测试和维护，降低引入缺陷的风险。

## 技术约束

### 技术栈要求

本项目使用以下技术栈，所有开发必须遵循相应的最佳实践：

**后端**:
- Java 1.8+, Spring Boot 2.7, Spring Security
- MyBatis-Plus 数据访问层
- MySQL 8.0 + Redis 缓存
- Apache Shiro 权限控制

**前端**:
- Vue 3 + TypeScript
- Element Plus UI 框架
- Vite 构建工具

**加密**:
- 国密算法：SM2（非对称）、SM3（哈希）、SM4（对称）
- 国际标准：AES-256、RSA-2048

### 代码质量标准

- 所有代码必须通过静态代码分析（无高危漏洞）
- 代码必须符合项目格式化规范
- 禁止提交包含 TODO 但没有关联 Issue 的代码
- 禁止硬编码敏感信息（密钥、密码、连接字符串）
- API 必须有清晰的错误码和错误信息定义

## 开发流程

### 代码审查

- 所有变更必须通过 Pull Request 提交
- PR 必须有至少一名团队成员审查批准
- 安全相关变更必须有安全团队成员审查
- 审查必须检查对本宪法原则的遵循

### 质量门禁

每次提交必须满足：

1. 代码编译成功
2. 所有现有测试通过
3. 新功能有对应测试
4. 无静态分析高危告警
5. 代码符合格式规范

### 部署流程

- 开发环境：自动部署，用于功能验证
- 测试环境：需通过所有自动化测试
- 生产环境：需完成安全扫描、性能测试、并获得审批

## 治理

### 修订流程

本宪法的修订需要：

1. 提出修订提案并说明理由
2. 在团队内部进行讨论
3. 评估对现有代码和流程的影响
4. 制定迁移计划（如有重大变更）
5. 更新版本号并记录变更日志
6. 通知所有团队成员

### 版本控制

版本遵循语义化版本规范：

- **主版本号（MAJOR）**：不兼容的原则变更或删除
- **次版本号（MINOR）**：新增原则或重大扩展
- **修订号（PATCH）**：澄清、措辞修正、非实质性调整

### 合规审查

- 所有 PR 审查必须验证对宪法原则的遵循
- 复杂度增加必须有明确理由
- 偏离宪法原则的情况必须记录在 Complexity Tracking 表中
- 定期进行代码库合规审查

**版本**: 1.0.0 | **批准日期**: 2025-12-31 | **最后修订**: 2025-12-31
