# BankShield å®‰å…¨åŠ å›ºæ¨¡å—

## æ¦‚è¿°

BankShieldå®‰å…¨åŠ å›ºæ¨¡å—æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„å®‰å…¨æ¡†æ¶ï¼Œä¸ºé“¶è¡Œæ•°æ®å®‰å…¨ç®¡ç†ç³»ç»Ÿæä¾›å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤ã€‚è¯¥æ¨¡å—åŒ…å«Webå®‰å…¨é˜²æŠ¤ã€APIå®‰å…¨å¼ºåŒ–ã€å®‰å…¨é…ç½®åŠ å›ºã€å®‰å…¨å®¡è®¡ã€åˆè§„æ€§æ£€æŸ¥å’Œåº”æ€¥å“åº”ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”’ Webå®‰å…¨é˜²æŠ¤
- **WAFè¿‡æ»¤å™¨**: é˜²å¾¡SQLæ³¨å…¥ã€XSSæ”»å‡»ã€å‘½ä»¤æ³¨å…¥ã€è·¯å¾„éå†ç­‰å¸¸è§Webæ”»å‡»
- **å®‰å…¨å“åº”å¤´**: è‡ªåŠ¨æ·»åŠ å®‰å…¨HTTPå¤´ï¼Œé˜²æ­¢ç‚¹å‡»åŠ«æŒã€MIMEç±»å‹å—…æ¢ç­‰æ”»å‡»
- **Cookieå®‰å…¨**: é…ç½®å®‰å…¨çš„Cookieå±æ€§ï¼Œé˜²æ­¢CSRFæ”»å‡»
- **è¯·æ±‚éªŒè¯**: å¯¹è¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“ã€è¯·æ±‚å¤´è¿›è¡Œå®‰å…¨éªŒè¯

### ğŸ›¡ï¸ APIå®‰å…¨å¼ºåŒ–
- **é«˜çº§é™æµ**: åŸºäºRedisçš„åˆ†å¸ƒå¼ä»¤ç‰Œæ¡¶é™æµç®—æ³•ï¼Œæ”¯æŒå¤šç§é™æµç­–ç•¥
- **APIç­¾åéªŒè¯**: é˜²æ­¢APIè¯·æ±‚è¢«ç¯¡æ”¹å’Œé‡æ”¾æ”»å‡»
- **è®¿é—®æ§åˆ¶**: ç»†ç²’åº¦çš„APIè®¿é—®æƒé™æ§åˆ¶
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯ä¿¡æ¯ä¿æŠ¤

### âš™ï¸ å®‰å…¨é…ç½®å¼ºåŒ–
- **å®‰å…¨åŸºçº¿æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥ç³»ç»Ÿå®‰å…¨é…ç½®ï¼Œç¡®ä¿ç¬¦åˆå®‰å…¨åŸºçº¿è¦æ±‚
- **å¯†ç ç­–ç•¥**: å¼ºåˆ¶å¯†ç å¤æ‚åº¦è¦æ±‚ï¼Œæ”¯æŒå¯†ç è¿‡æœŸå’Œå†å²å¯†ç æ£€æŸ¥
- **ä¼šè¯å®‰å…¨**: ä¼šè¯è¶…æ—¶ç®¡ç†ã€ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤
- **åŠ å¯†é…ç½®**: å¼ºåˆ¶ä½¿ç”¨å®‰å…¨çš„åŠ å¯†ç®—æ³•å’Œåè®®

### ğŸ“Š å®‰å…¨å®¡è®¡
- **å®‰å…¨äº‹ä»¶æ—¥å¿—**: å®Œæ•´çš„å®‰å…¨äº‹ä»¶è®°å½•å’Œè¿½è¸ª
- **å®æ—¶ç›‘æ§**: å®æ—¶å®‰å…¨äº‹ä»¶ç›‘æ§å’Œå‘Šè­¦
- **å®¡è®¡æŠ¥è¡¨**: è‡ªåŠ¨ç”Ÿæˆå®‰å…¨å®¡è®¡æŠ¥å‘Š
- **è¡Œä¸ºåˆ†æ**: ç”¨æˆ·è¡Œä¸ºåˆ†æå’Œå¼‚å¸¸æ£€æµ‹

### âœ… åˆè§„æ€§æ£€æŸ¥
- **ç­‰ä¿åˆè§„**: ç¬¦åˆç­‰çº§ä¿æŠ¤2.0ä¸‰çº§è¦æ±‚
- **PCI DSS**: æ”¯æŒPCI DSSåˆè§„æ€§æ£€æŸ¥
- **ISO 27001**: ç¬¦åˆISO 27001ä¿¡æ¯å®‰å…¨ç®¡ç†æ ‡å‡†
- **è‡ªåŠ¨æ£€æŸ¥**: å®šæœŸè‡ªåŠ¨æ‰§è¡Œåˆè§„æ€§æ£€æŸ¥

### ğŸš¨ åº”æ€¥å“åº”
- **è‡ªåŠ¨å“åº”**: æ ¹æ®å®‰å…¨äº‹ä»¶ä¸¥é‡ç¨‹åº¦è‡ªåŠ¨æ‰§è¡Œå“åº”åŠ¨ä½œ
- **IPé˜»æ–­**: è‡ªåŠ¨é˜»æ–­æ¶æ„IPåœ°å€
- **è´¦æˆ·ç®¡ç†**: è‡ªåŠ¨ç¦ç”¨é£é™©è´¦æˆ·
- **ç³»ç»Ÿéš”ç¦»**: ç´§æ€¥æƒ…å†µä¸‹è‡ªåŠ¨éš”ç¦»ç³»ç»Ÿ

## æ ¸å¿ƒç»„ä»¶

### 1. WafFilter (Webåº”ç”¨é˜²ç«å¢™è¿‡æ»¤å™¨)
```java
@Component
@Order(1)
public class WafFilter extends OncePerRequestFilter
```

**åŠŸèƒ½**:
- SQLæ³¨å…¥æ£€æµ‹å’Œé˜²æŠ¤
- XSSæ”»å‡»æ£€æµ‹å’Œé˜²æŠ¤
- å‘½ä»¤æ³¨å…¥æ£€æµ‹å’Œé˜²æŠ¤
- è·¯å¾„éå†æ£€æµ‹å’Œé˜²æŠ¤
- å¼‚å¸¸è¯·æ±‚å¤´æ£€æµ‹

**é…ç½®**:
```yaml
security:
  waf:
    enabled: true
    sql-injection-mode: strict
    xss-detection-mode: strict
    max-user-agent-length: 500
```

### 2. SecureHeadersFilter (å®‰å…¨å“åº”å¤´è¿‡æ»¤å™¨)
```java
@Component
@Order(2)
public class SecureHeadersFilter extends OncePerRequestFilter
```

**åŠŸèƒ½**:
- æ·»åŠ X-Content-Type-Options: nosniff
- æ·»åŠ X-XSS-Protection: 1; mode=block
- æ·»åŠ X-Frame-Options: DENY
- æ·»åŠ Strict-Transport-Security
- é…ç½®Content-Security-Policy
- ç§»é™¤æ•æ„Ÿå“åº”å¤´

### 3. AdvancedRateLimiter (é«˜çº§é™æµå™¨)
```java
@Component
public class AdvancedRateLimiter
```

**åŠŸèƒ½**:
- åŸºäºRedisçš„åˆ†å¸ƒå¼é™æµ
- ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°
- æ”¯æŒå¤šç§é™æµç­–ç•¥
- Luaè„šæœ¬åŸå­åŒ–æ“ä½œ
- å®æ—¶ç›‘æ§å’Œç»Ÿè®¡

**é…ç½®**:
```yaml
security:
  rate-limit:
    enabled: true
    default-rules:
      - path: "/api/user/login"
        rate: 10
        capacity: 50
        period: 1s
        type: "login"
```

### 4. ApiSignatureVerifier (APIç­¾åéªŒè¯å™¨)
```java
@Component
public class ApiSignatureVerifier
```

**åŠŸèƒ½**:
- APIè¯·æ±‚ç­¾åéªŒè¯
- é˜²æ­¢è¯·æ±‚ç¯¡æ”¹
- é˜²æ­¢é‡æ”¾æ”»å‡»
- æ—¶é—´æˆ³éªŒè¯
- NonceéªŒè¯

### 5. SecurityEventLogger (å®‰å…¨äº‹ä»¶æ—¥å¿—è®°å½•å™¨)
```java
@Component
public class SecurityEventLogger
```

**åŠŸèƒ½**:
- å®‰å…¨äº‹ä»¶å¼‚æ­¥è®°å½•
- äº‹ä»¶çº§åˆ«åˆ†ç±»
- å®æ—¶å‘Šè­¦æœºåˆ¶
- ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
- å®¡è®¡æ—¥å¿—ç”Ÿæˆ

### 6. SecurityBaselineChecker (å®‰å…¨åŸºçº¿æ£€æŸ¥å™¨)
```java
@Component
public class SecurityBaselineChecker
```

**åŠŸèƒ½**:
- è‡ªåŠ¨å®‰å…¨åŸºçº¿æ£€æŸ¥
- å¤šç»´åº¦å®‰å…¨æ£€æŸ¥
- åˆè§„æ€§è¯„ä¼°
- ä¿®å¤å»ºè®®ç”Ÿæˆ
- æ£€æŸ¥æŠ¥å‘Šç”Ÿæˆ

### 7. SecurityIncidentResponder (å®‰å…¨äº‹ä»¶å“åº”å™¨)
```java
@Component
public class SecurityIncidentResponder
```

**åŠŸèƒ½**:
- è‡ªåŠ¨äº‹ä»¶å“åº”
- åˆ†çº§å“åº”ç­–ç•¥
- IPè‡ªåŠ¨é˜»æ–­
- è´¦æˆ·è‡ªåŠ¨ç®¡ç†
- ç³»ç»Ÿéš”ç¦»æœºåˆ¶

## é…ç½®è¯´æ˜

### åŸºæœ¬é…ç½®
```yaml
# application.yml
security:
  # å¯ç”¨å®‰å…¨åŠ å›ºæ¨¡å—
  enabled: true
  
  # WAFé…ç½®
  waf:
    enabled: true
    sql-injection-mode: strict
    xss-detection-mode: strict
    
  # é™æµé…ç½®
  rate-limit:
    enabled: true
    redis:
      key-prefix: "bankshield:rate_limit:"
      
  # ç­¾åéªŒè¯é…ç½®
  signature:
    enabled: true
    expire-time: 300000  # 5åˆ†é’Ÿ
    
  # äº‹ä»¶å“åº”é…ç½®
  incident:
    enabled: true
    auto-response: true
    auto-block: true
```

### é«˜çº§é…ç½®
```yaml
# security-hardening.yml
bankshield:
  security:
    # å¯†ç ç­–ç•¥
    password-policy:
      min-length: 8
      require-uppercase: true
      require-lowercase: true
      require-digit: true
      require-special: true
      
    # ä¼šè¯é…ç½®
    session:
      timeout: 30m
      max-concurrent-sessions: 1
      session-fixation-protection: true
      
    # æ•°æ®ä¿æŠ¤
    data-protection:
      encryption:
        enabled: true
        algorithm: "SM4"
        key-rotation-days: 90
        
    # å®¡è®¡é…ç½®
    audit:
      enabled: true
      retention-days: 365
      storage: "database"
      
    # åˆè§„æ€§æ£€æŸ¥
    compliance:
      enabled: true
      level-2.0-grade-3: true
      pci-dss: true
      iso-27001: true
```

## APIæ¥å£

### å®‰å…¨åŸºçº¿æ£€æŸ¥
```http
GET /api/security/baseline/check
```

### è·å–å®‰å…¨ç»Ÿè®¡
```http
GET /api/security/stats?date=20231224
```

### é™æµçŠ¶æ€æŸ¥è¯¢
```http
GET /api/security/rate-limit/status?userId=123&path=/api/user/login
```

### é‡ç½®é™æµ
```http
POST /api/security/rate-limit/reset?userId=123&path=/api/user/login
```

### è¢«é˜»æ–­IPåˆ—è¡¨
```http
GET /api/security/blocked-ips?date=20231224
```

### è§£é™¤IPé˜»æ–­
```http
POST /api/security/unblock-ip?ip=192.168.1.100
```

### åˆ›å»ºå®‰å…¨äº‹ä»¶
```http
POST /api/security/incidents
Content-Type: application/json

{
  "title": "æš´åŠ›ç ´è§£æ”»å‡»",
  "description": "æ£€æµ‹åˆ°å¤šæ¬¡ç™»å½•å¤±è´¥å°è¯•",
  "type": "BRUTE_FORCE",
  "severity": "HIGH",
  "userId": "admin",
  "sourceIp": "192.168.1.100"
}
```

### è·å–å®‰å…¨äº‹ä»¶åˆ—è¡¨
```http
GET /api/security/incidents?severity=HIGH&status=RESPONDING&date=20231224
```

### æ›´æ–°äº‹ä»¶çŠ¶æ€
```http
PUT /api/security/incidents/{id}/status?status=RESOLVED
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. å¯ç”¨å®‰å…¨åŠ å›º
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Autowired
    private SecurityHardeningConfig securityHardeningConfig;
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.apply(securityHardeningConfig);
    }
}
```

### 2. è‡ªå®šä¹‰é™æµè§„åˆ™
```java
@Component
public class CustomRateLimitConfig {
    
    @Autowired
    private AdvancedRateLimiter rateLimiter;
    
    @PostConstruct
    public void init() {
        // æ·»åŠ è‡ªå®šä¹‰é™æµè§„åˆ™
        rateLimiter.addRule("/api/sensitive/*", 5, 25, Duration.ofSeconds(1), "sensitive");
    }
}
```

### 3. è®°å½•å®‰å…¨äº‹ä»¶
```java
@Service
public class UserService {
    
    @Autowired
    private SecurityEventLogger eventLogger;
    
    public void login(String username, String password, String ip) {
        boolean success = authenticate(username, password);
        
        eventLogger.logLoginEvent(username, success, ip, 
            success ? null : "Invalid credentials");
        
        if (!success) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘å®‰å…¨äº‹ä»¶
            checkBruteForceAttack(username, ip);
        }
    }
}
```

### 4. å¤„ç†å®‰å…¨äº‹ä»¶
```java
@Component
public class SecurityEventHandler {
    
    @Autowired
    private SecurityIncidentResponder incidentResponder;
    
    public void handleBruteForceAttack(String username, String ip) {
        SecurityIncident incident = new SecurityIncident();
        incident.setTitle("æš´åŠ›ç ´è§£æ”»å‡»");
        incident.setDescription("æ£€æµ‹åˆ°å¤šæ¬¡ç™»å½•å¤±è´¥å°è¯•");
        incident.setType("BRUTE_FORCE");
        incident.setSeverity(Severity.HIGH);
        incident.setUserId(username);
        incident.setSourceIp(ip);
        
        incidentResponder.handleIncident(incident);
    }
}
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. é…ç½®å»ºè®®
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨æ‰€æœ‰å®‰å…¨åŠŸèƒ½
- å®šæœŸæ›´æ–°å®‰å…¨è§„åˆ™å’Œç­–ç•¥
- é…ç½®åˆé€‚çš„é™æµé˜ˆå€¼
- å¯ç”¨è¯¦ç»†çš„å®¡è®¡æ—¥å¿—
- å®šæœŸæ‰§è¡Œå®‰å…¨åŸºçº¿æ£€æŸ¥

### 2. ç›‘æ§å»ºè®®
- ç›‘æ§å®‰å…¨äº‹ä»¶è¶‹åŠ¿
- è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- å®šæœŸåˆ†æå®‰å…¨æ—¥å¿—
- å…³æ³¨å¼‚å¸¸è®¿é—®æ¨¡å¼
- åŠæ—¶å“åº”å®‰å…¨å‘Šè­¦

### 3. è¿ç»´å»ºè®®
- å®šæœŸå¤‡ä»½å®‰å…¨é…ç½®
- æµ‹è¯•åº”æ€¥å“åº”æµç¨‹
- æ›´æ–°å®‰å…¨è¡¥ä¸
- åŸ¹è®­å®‰å…¨æ„è¯†
- åˆ¶å®šå®‰å…¨ç­–ç•¥

## åˆè§„æ€§æ”¯æŒ

### ç­‰çº§ä¿æŠ¤2.0ï¼ˆä¸‰çº§ï¼‰
- âœ… è®¿é—®æ§åˆ¶
- âœ… å®‰å…¨å®¡è®¡
- âœ… é€šä¿¡å®Œæ•´æ€§
- âœ… é€šä¿¡ä¿å¯†æ€§
- âœ… æ•°æ®å®Œæ•´æ€§
- âœ… æ•°æ®ä¿å¯†æ€§
- âœ… å¤‡ä»½æ¢å¤
- âœ… å‰©ä½™ä¿¡æ¯ä¿æŠ¤
- âœ… ä¸ªäººä¿¡æ¯ä¿æŠ¤

### PCI DSS
- âœ… å®‰å…¨ç½‘ç»œå’Œç³»ç»Ÿ
- âœ… æŒå¡äººæ•°æ®ä¿æŠ¤
- âœ… æ¼æ´ç®¡ç†
- âœ… è®¿é—®æ§åˆ¶
- âœ… ç½‘ç»œç›‘æ§
- âœ… ä¿¡æ¯å®‰å…¨æ”¿ç­–

### ISO 27001
- âœ… ä¿¡æ¯å®‰å…¨æ”¿ç­–
- âœ… ç»„ç»‡ä¿¡æ¯å®‰å…¨
- âœ… äººåŠ›èµ„æºå®‰å…¨
- âœ… èµ„äº§ç®¡ç†
- âœ… è®¿é—®æ§åˆ¶
- âœ… å¯†ç å­¦
- âœ… ç‰©ç†å’Œç¯å¢ƒå®‰å…¨
- âœ… æ“ä½œå®‰å…¨
- âœ… é€šä¿¡å®‰å…¨
- âœ… ç³»ç»Ÿè·å–ã€å¼€å‘å’Œç»´æŠ¤
- âœ… ä¾›åº”å•†å…³ç³»
- âœ… ä¿¡æ¯å®‰å…¨äº‹ä»¶ç®¡ç†
- âœ… ä¸šåŠ¡è¿ç»­æ€§ç®¡ç†
- âœ… åˆè§„æ€§

## æ€§èƒ½ä¼˜åŒ–

### 1. WAFæ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨é«˜æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼
- å¯ç”¨è¯·æ±‚ç¼“å­˜æœºåˆ¶
- é…ç½®åˆç†çš„æ£€æµ‹è¶…æ—¶
- ä½¿ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼

### 2. é™æµæ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨Redisé›†ç¾¤
- ä¼˜åŒ–Luaè„šæœ¬
- é…ç½®åˆç†çš„TTL
- ä½¿ç”¨æ‰¹é‡æ“ä½œ

### 3. å®¡è®¡æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨å¼‚æ­¥æ—¥å¿—è®°å½•
- é…ç½®æ—¥å¿—çº§åˆ«
- å®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—
- ä½¿ç”¨æ‰¹é‡å†™å…¥

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **WAFè¯¯æŠ¥ç‡é«˜**
   - è°ƒæ•´æ£€æµ‹æ¨¡å¼ä¸ºnormalæˆ–loose
   - é…ç½®ç™½åå•è§„åˆ™
   - æ›´æ–°æ£€æµ‹è§„åˆ™

2. **é™æµå½±å“æ­£å¸¸ç”¨æˆ·**
   - è°ƒæ•´é™æµé˜ˆå€¼
   - é…ç½®ç”¨æˆ·ç™½åå•
   - ä½¿ç”¨æ›´ç²¾ç»†çš„é™æµç­–ç•¥

3. **ç­¾åéªŒè¯å¤±è´¥**
   - æ£€æŸ¥æ—¶é’ŸåŒæ­¥
   - éªŒè¯å¯†é’¥é…ç½®
   - æ£€æŸ¥ç­¾åç®—æ³•

4. **æ€§èƒ½é—®é¢˜**
   - å¯ç”¨ç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - ä½¿ç”¨å¼‚æ­¥å¤„ç†

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12-24)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ å®ç°WAFè¿‡æ»¤å™¨
- âœ¨ å®ç°å®‰å…¨å“åº”å¤´è¿‡æ»¤å™¨
- âœ¨ å®ç°é«˜çº§é™æµå™¨
- âœ¨ å®ç°APIç­¾åéªŒè¯å™¨
- âœ¨ å®ç°å®‰å…¨äº‹ä»¶æ—¥å¿—è®°å½•å™¨
- âœ¨ å®ç°å®‰å…¨åŸºçº¿æ£€æŸ¥å™¨
- âœ¨ å®ç°å®‰å…¨äº‹ä»¶å“åº”å™¨
- âœ¨ æ·»åŠ å®Œæ•´çš„é…ç½®æ”¯æŒ
- âœ¨ æ·»åŠ RESTful APIæ¥å£
- âœ¨ æ·»åŠ è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹
- âœ¨ æ·»åŠ å®Œæ•´çš„æ–‡æ¡£

## æ”¯æŒä¸ç»´æŠ¤

### æŠ€æœ¯æ”¯æŒ
- æ–‡æ¡£åœ°å€: https://docs.bankshield.com
- é—®é¢˜åé¦ˆ: https://github.com/your-org/BankShield/issues
- æŠ€æœ¯æ”¯æŒ: support@bankshield.com

### æ›´æ–°ç»´æŠ¤
- å®šæœŸæ›´æ–°å®‰å…¨è§„åˆ™
- æŒç»­ä¼˜åŒ–æ€§èƒ½
- åŠæ—¶ä¿®å¤å®‰å…¨æ¼æ´
- ä¸æ–­å®Œå–„åŠŸèƒ½

## è®¸å¯è¯

Apache License 2.0

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥å®Œå–„é¡¹ç›®ï¼è¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„CONTRIBUTING.mdæ–‡ä»¶ã€‚

---

**æ³¨æ„**: æœ¬å®‰å…¨åŠ å›ºæ¨¡å—æ˜¯BankShieldæ•°æ®å®‰å…¨ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè¯·ç¡®ä¿æ­£ç¡®é…ç½®å’Œä½¿ç”¨ï¼Œä»¥ä¿éšœç³»ç»Ÿå®‰å…¨ã€‚